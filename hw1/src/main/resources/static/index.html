<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moliceiro Meal Booking</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
    }
    select, button {
      margin: 1rem 0;
    }
    .meal {
      border: 1px solid #ccc;
      padding: 1rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h1>üìÖ Refei√ß√µes no Campus Moliceiro</h1>

  <label for="restaurant">Escolhe o restaurante:</label>
  <select id="restaurant">
    <option value="CantinaMoliceiro">Cantina Moliceiro</option>
    <option value="RestauranteCentral">Restaurante Central</option>
  </select>
  <button onclick="loadMeals()">üîç Ver Refei√ß√µes</button>

  <div id="meals"></div>

  <script>
    async function loadMeals() {
      const restaurant = document.getElementById("restaurant").value;
      const response = await fetch(`/api/meals?restaurant=${restaurant}`);
      const data = await response.json();

      const container = document.getElementById("meals");
      container.innerHTML = "";

      if (data.length === 0) {
        container.innerHTML = "<p>Sem refei√ß√µes dispon√≠veis para os pr√≥ximos dias.</p>";
        return;
      }

      data.forEach(meal => {
        const div = document.createElement("div");
        div.className = "meal";
        div.innerHTML = `
          <strong>Data:</strong> ${meal.date}<br>
          <strong>Prato:</strong> ${meal.description}<br>
          <strong>Previs√£o:</strong> ${meal.weather || "N/A"}<br>
          <button onclick="bookMeal('${meal.restaurant}', '${meal.date}')">Reservar</button>
        `;
        container.appendChild(div);
      });
    }

    async function bookMeal(restaurant, date) {
      const response = await fetch("/api/reservations", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ restaurant, date })
      });
      const data = await response.json();
      alert(`Reserva criada! C√≥digo: ${data.token}`);
    }
  </script>
</body>
</html>